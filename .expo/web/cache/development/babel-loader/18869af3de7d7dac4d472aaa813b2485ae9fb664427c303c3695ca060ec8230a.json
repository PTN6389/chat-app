{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nimport { useState, useEffect } from \"react\";\nimport { Bubble, GiftedChat, InputToolbar } from \"react-native-gifted-chat\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport View from \"react-native-web/dist/exports/View\";\nimport KeyboardAvoidingView from \"react-native-web/dist/exports/KeyboardAvoidingView\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport { addDoc, collection, onSnapshot, orderBy, query } from \"firebase/firestore\";\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport MapView from \"react-native-maps\";\nimport CustomActions from \"./CustomActions\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar Chat = function Chat(_ref) {\n  var db = _ref.db,\n    route = _ref.route,\n    navigation = _ref.navigation,\n    isConnected = _ref.isConnected,\n    storage = _ref.storage;\n  var _route$params = route.params,\n    userID = _route$params.userID,\n    name = _route$params.name,\n    color = _route$params.color;\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    messages = _useState2[0],\n    setMessages = _useState2[1];\n  var loadCachedMessages = function () {\n    var _ref2 = _asyncToGenerator(function* () {\n      var cachedMessages = (yield AsyncStorage.getItem(\"messages\")) || [];\n      setMessages(JSON.parse(cachedMessages));\n    });\n    return function loadCachedMessages() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var unsubMessages;\n  useEffect(function () {\n    navigation.setOptions({\n      title: name\n    });\n    if (isConnected === true) {\n      if (unsubMessages) unsubMessages();\n      unsubMessages = null;\n      var q = query(collection(db, \"messages\"), orderBy(\"createdAt\", \"desc\"));\n      unsubMessages = onSnapshot(q, function (documentsSnapshot) {\n        var newMessages = [];\n        documentsSnapshot.forEach(function (doc) {\n          newMessages.push(_objectSpread(_objectSpread({\n            id: doc.id\n          }, doc.data()), {}, {\n            createdAt: new Date(doc.data().createdAt.toMillis())\n          }));\n        });\n        cacheMessages(newMessages);\n        setMessages(newMessages);\n      });\n    } else loadCachedMessages();\n    return function () {\n      if (unsubMessages) unsubMessages();\n    };\n  }, [isConnected]);\n  var cacheMessages = function () {\n    var _ref3 = _asyncToGenerator(function* (messagesToCache) {\n      try {\n        yield AsyncStorage.setItem(\"messages\", JSON.stringify(messagesToCache));\n      } catch (error) {\n        console.log(error.message);\n      }\n    });\n    return function cacheMessages(_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var _onSend = function onSend(newMessages) {\n    addDoc(collection(db, \"messages\"), newMessages[0]);\n  };\n  {}\n  var renderBubble = function renderBubble(props) {\n    return _jsx(Bubble, _objectSpread(_objectSpread({}, props), {}, {\n      wrapperStyle: {\n        right: {\n          backgroundColor: \"#000\"\n        },\n        left: {\n          backgroundColor: \"#fff\"\n        }\n      }\n    }));\n  };\n  var renderInputToolbar = function renderInputToolbar(props) {\n    if (isConnected) return _jsx(InputToolbar, _objectSpread({}, props));else return null;\n  };\n  var renderCustomActions = function renderCustomActions(props) {\n    return _jsx(CustomActions, _objectSpread({\n      storage: storage\n    }, props));\n  };\n  var renderCustomView = function renderCustomView(props) {\n    var currentMessage = props.currentMessage;\n    if (currentMessage.location) {\n      return _jsx(MapView, {\n        style: {\n          width: 150,\n          height: 100,\n          borderRadius: 13,\n          margin: 3\n        },\n        region: {\n          latitude: currentMessage.location.latitude,\n          longitude: currentMessage.location.longitude,\n          latitudeDelta: 0.0922,\n          longitudeDelta: 0.0421\n        }\n      });\n    }\n    return null;\n  };\n  return _jsxs(View, {\n    style: [styles.container, {\n      backgroundColor: color\n    }],\n    children: [_jsx(GiftedChat, {\n      messages: messages,\n      renderBubble: renderBubble,\n      renderInputToolbar: renderInputToolbar,\n      renderActions: renderCustomActions,\n      renderCustomView: renderCustomView,\n      onSend: function onSend(messages) {\n        return _onSend(messages);\n      },\n      user: {\n        _id: userID,\n        name: name\n      }\n    }), Platform.OS === 'android' ? _jsx(KeyboardAvoidingView, {\n      behavior: \"height\"\n    }) : null]\n  });\n};\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1\n  }\n});\nexport default Chat;","map":{"version":3,"names":["useState","useEffect","Bubble","GiftedChat","InputToolbar","StyleSheet","View","KeyboardAvoidingView","Platform","addDoc","collection","onSnapshot","orderBy","query","AsyncStorage","MapView","CustomActions","jsx","_jsx","jsxs","_jsxs","Chat","_ref","db","route","navigation","isConnected","storage","_route$params","params","userID","name","color","_useState","_useState2","_slicedToArray","messages","setMessages","loadCachedMessages","_ref2","_asyncToGenerator","cachedMessages","getItem","JSON","parse","apply","arguments","unsubMessages","setOptions","title","q","documentsSnapshot","newMessages","forEach","doc","push","_objectSpread","id","data","createdAt","Date","toMillis","cacheMessages","_ref3","messagesToCache","setItem","stringify","error","console","log","message","_x","onSend","renderBubble","props","wrapperStyle","right","backgroundColor","left","renderInputToolbar","renderCustomActions","renderCustomView","currentMessage","location","style","width","height","borderRadius","margin","region","latitude","longitude","latitudeDelta","longitudeDelta","styles","container","children","renderActions","user","_id","OS","behavior","create","flex"],"sources":["C:/Users/Christina/Documents/Career/CareerFoundry/chat-app/components/Chat.js"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { Bubble, GiftedChat, InputToolbar } from \"react-native-gifted-chat\";\r\nimport { StyleSheet, View, KeyboardAvoidingView, Platform } from \"react-native\";\r\nimport { addDoc, collection, onSnapshot, orderBy, query } from \"firebase/firestore\";\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\nimport MapView from \"react-native-maps\";\r\nimport CustomActions from \"./CustomActions\";\r\n\r\nconst Chat = ({db, route, navigation, isConnected, storage}) => {\r\n    const { userID, name, color } = route.params;\r\n    const [messages, setMessages] = useState([]);\r\n\r\n    const loadCachedMessages = async () => {\r\n        const cachedMessages = await AsyncStorage.getItem(\"messages\") || [];\r\n        setMessages(JSON.parse(cachedMessages));\r\n    }\r\n\r\n    let unsubMessages;\r\n    useEffect(() => {\r\n        navigation.setOptions({ title: name });\r\n        \r\n        if (isConnected === true) {\r\n            if(unsubMessages) unsubMessages();\r\n            unsubMessages = null;\r\n\r\n        const q = query(collection(db, \"messages\"), orderBy(\"createdAt\", \"desc\"));\r\n        unsubMessages = onSnapshot(q, (documentsSnapshot) => {\r\n            let newMessages = [];\r\n            documentsSnapshot.forEach(doc => {\r\n                newMessages.push({ \r\n                    id: doc.id, \r\n                    ...doc.data(), \r\n                    createdAt: new Date(doc.data().createdAt.toMillis())\r\n                })\r\n            });\r\n            cacheMessages(newMessages)\r\n            setMessages(newMessages);  \r\n        });\r\n        } else loadCachedMessages();\r\n\r\n        //clean up code\r\n        return() => {\r\n            if (unsubMessages) unsubMessages();\r\n        }\r\n    }, [isConnected]);\r\n\r\n    const cacheMessages = async (messagesToCache) => {\r\n        try {\r\n            await AsyncStorage.setItem(\"messages\", JSON.stringify(messagesToCache)); \r\n        } catch (error) {\r\n            console.log(error.message);\r\n        }\r\n    }\r\n\r\n    const onSend = (newMessages) => {\r\n        addDoc(collection(db, \"messages\"), newMessages[0])\r\n    }\r\n\r\n    {/* Change the color of the bubbles */}\r\n    const renderBubble = (props) => {\r\n        return <Bubble\r\n        {...props}\r\n        wrapperStyle={{\r\n            right: {\r\n                backgroundColor: \"#000\"\r\n            },\r\n            left: {\r\n                backgroundColor: \"#fff\"\r\n            }\r\n        }}\r\n        />\r\n    };\r\n\r\n    const renderInputToolbar = (props) => {\r\n        if(isConnected) return <InputToolbar\r\n            {...props} />;\r\n        else return null;\r\n    };\r\n\r\n    const renderCustomActions = (props) => {\r\n        return <CustomActions storage={storage} {...props} />;\r\n    };\r\n\r\n    const renderCustomView = (props) => {\r\n        const { currentMessage } = props;\r\n        if(currentMessage.location) {\r\n            return (\r\n                <MapView \r\n                    style={{width: 150, height: 100, borderRadius: 13, margin: 3}}\r\n                    region={{\r\n                        latitude: currentMessage.location.latitude,\r\n                        longitude: currentMessage.location.longitude,\r\n                        latitudeDelta: 0.0922,\r\n                        longitudeDelta: 0.0421\r\n                    }}\r\n                />\r\n            );\r\n        }\r\n        return null;\r\n    }\r\n\r\n    return(\r\n        <View style={[styles.container,{backgroundColor: color}]}>\r\n            <GiftedChat \r\n                messages={messages}\r\n                renderBubble={renderBubble}\r\n                renderInputToolbar={renderInputToolbar}\r\n                renderActions={renderCustomActions}\r\n                renderCustomView={renderCustomView}\r\n                onSend={(messages) => onSend(messages)}   \r\n                user={{\r\n                    _id: userID,\r\n                    name\r\n                }}\r\n                         \r\n            />\r\n            {/* Fixes issue with keyboard overlapping chat input text box for older android */}\r\n            { Platform.OS === 'android' ? <KeyboardAvoidingView behavior=\"height\" /> : null }\r\n        </View>\r\n    );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    container: {\r\n        flex: 1\r\n    }\r\n});\r\n\r\nexport default Chat;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}